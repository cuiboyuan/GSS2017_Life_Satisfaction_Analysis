---
title: "Title of Your Report"
author: "Boyuan Cui, Zhaocheng Li"
date: "Oct 19, 2020"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)

library(tidyverse)
library(brms)
```

## Title of your Report

# Name(s) of Author(s) 
# Date

## Abstract

Here is where you give a brief (one paragraph overview of your entire paper). This should include some background/introduction, some methodology, results and conclusions.

## Introduction

Here is where you should give insight into the setting and introduce the goal of the analysis. Here you can introduce ideas and basic concepts regarding the study setting and the potential model. Again, this is the introduction, so you should be explaining the importance of the work that is ahead and hopefully build some suspense for the reader. You can also highlight what will be included in the subsequent sections.

Starting from 1985, Statistics Canada conducted General Social Survey (GSS) every year to collect cross-sectional data on non-institutionalized Canadian citizens over 15 years old to address and discover new  social issues. One of the primary objective of GSS is to monitor factors that affect Canadians' well-beings of that specific year (reference to user guide). We believe that an important indicator of a person's well-being is his/her own attitude towards life. If we are aware of what aspects promote or damage one's feeling of life, the government and any social agencies will have better insights on what they should do to make the society better off. We believe it is important to know which factors are influential on people's feeling of life as a whole, and we may find some unexpected discoveries.

The following sections will specifically explore the impact of marital status, education level, individual income, family income, self rated health, and average working hours on one's feeling of life, and we will apply a Bayesian linear model to analyze the relationship.


 1) Income respondent (ttlincg2)  VS  Education (ehg3_01b).    2) Income respondent (ttlincg2) VS  Feelings about life as a whole (slm_01). 
   3) Dwelling type of the respondent (dwelc) VS Income respondent (ttlincg2)  4)  partner_education = (eop_200)  VS   income_family = (famincg2)
   5) Feelings about life as a whole (slm_01) VS   occupation = (noc1610)

## Data

Introduce the data, explain why it was selected. Make sure to comment on important features and highlight any potential drawbacks to the data.
```{r, echo=FALSE}
gss <- read_csv("gss.csv")
gss_data <-  select(gss, feelings_life, marital_status, education, average_hours_worked, self_rated_health, income_family, income_respondent) %>% na.omit()

group_by(gss_data, education) %>% summarise()

health_numeric <- case_when(gss_data$self_rated_health=="Excellent" ~ 5,
          gss_data$self_rated_health=="Very good" ~ 4,
          gss_data$self_rated_health=="Good" ~ 3,
          gss_data$self_rated_health=="Fair" ~ 2,
          gss_data$self_rated_health=="Poor" ~ 1
          )
          

work_hours_numeric = case_when(gss_data$ average_hours_worked=="50.1 hours and more" ~ 5,
                               gss_data$ average_hours_worked=="40.1 to 50.0 hours" ~ 4,
                               gss_data$ average_hours_worked=="30.0 to 40.0 hours" ~ 3,
                               gss_data$ average_hours_worked=="0.1 to 29.9 hours" ~ 2,
                               gss_data$ average_hours_worked=="0 hour" ~ 1)

Incomefam_numeric = case_when(gss_data$ income_family=="$125,000 and more" ~ 6,
                              gss_data$ income_family=="$100,000 to $ 124,999" ~ 5,
                              gss_data$ income_family=="$75,000 to $99,999" ~ 4,
                              gss_data$ income_family=="$50,000 to $74,999" ~ 3,
                              gss_data$ income_family=="$25,000 to $49,999" ~ 2,
                              gss_data$ income_family=="Less than $25,000" ~ 1)
                              
IncomeRes_numeric = case_when(gss_data$income_respondent=="$125,000 and more" ~ 6,
          gss_data$income_respondent=="$100,000 to $ 124,999" ~ 5,
          gss_data$income_respondent=="$75,000 to $99,999" ~ 4,
          gss_data$income_respondent=="$50,000 to $74,999" ~ 3,
          gss_data$income_respondent=="$25,000 to $49,999" ~ 2,
          gss_data$income_respondent=="Less than $25,000" ~ 1
          )
edu = case_when(gss_data$education=="University certificate, diploma or degree above the bach..." ~ 7,
          gss_data$education=="Bachelor's degree (e.g. B.A., B.Sc., LL.B.)" ~ 6,
          gss_data$education=="University certificate or diploma below the bachelor's level" ~ 5,
          gss_data$education=="College, CEGEP or other non-university certificate or di..." ~ 4,
          gss_data$education=="Trade certificate or diploma" ~ 3,
          gss_data$education=="High school diploma or a high school equivalency certificate" ~ 2,
          gss_data$education=="Less than high school diploma or its equivalent" ~ 1
          )

gss_numeric = data.frame(feelings_life = gss_data$feelings_life, marriage = factor(gss_data$marital_status), education=edu, health=health_numeric, income_respondent=IncomeRes_numeric,
                         income_family=Incomefam_numeric, work_hours=work_hours_numeric) %>% na.omit()

```


### Data Extraction

We first obtain the GSS data from the CHASS website ('AAIpsmGG.csv'), and clean the file with code from 'gss_cleaning.R' (written by professor Rohan Alexander and Sam Caetano) to make the raw data more interpreteble. The data file after cleaning is 'gss.csv'

Then, we select our interest variables--marital status, education level, individual income, family income, self rated health, average working hours, and one's feeling of life--from the cleaned data, and we remove every case with NA or "Don't know" responses from the dataset. For the convenience of modelling, we will convert some categorical data to numeric variables. We will briefly explain each variable in the following section.

### Variable Explanations

#### Response Variable


__Feeling of life__ (code in raw data:SLM_01, name in 'gss.csv':feelings_life) is a continuous numeric data ranging from 0 to 10 that indicates the respondent's feeling of life as a whole. 0 means very dissatisfied and 10 means very satisfied (reference from data).

#### Explanatory Variables


__Marital status__ (code in raw data:MARSTAT, name in 'gss.csv':marital_status) is a categorical data indicating whether the respondent is divorced
```{r, echo=FALSE}
group_by(gss_numeric, marriage) %>% summarise(.groups = 'drop') %>%tibble()
```

We will not convert this data to numeric, since it is not intuitive to separate marital status into different levels. It is not reasonable to say that married is better than single, so we will leave this variable as categorical. But for concision purpose, we will give each marital status a code number for future reference:

```{r, echo=FALSE}
tibble('Marital status'=levels(gss_numeric$marriage),'Reference Code'=c(1:6))
```

__Education level__ (code in raw data:EHG3_01B, name in 'gss.csv':education) is a categorical data that indicates the highest education the respondent acquires. Because the question asks for the highest education level achieved, it is reasonable to use numeric data to represent different levels of education. The variable after transformation will range from 1-7, representing from the lowest to the highest education level (we use the order of education level from the original GSS). Below is a reference table:
```{r, echo=FALSE}
edu_name = c("Less than high school diploma or its equivalent","High school diploma or a high school equivalency certificate","Trade certificate or diploma","College, CEGEP or other non-university certificate or diploma (other than trades certificates or diplomas)","University certificate or diploma below the bachelor's level","Bachelor's degree (e.g. B.A., B.Sc., LL.B.)","University certificate, diploma or degree above the bachelorâ€™s level")
rank = group_by(gss_numeric, education) %>% summarise(.groups = 'drop')
rank = rank$education
tibble(`Education Level`=edu_name, `Numeric Rank`=rank)
```


__Individual income__ (code in raw data:TTLINCG2, name in 'gss.csv':income_respondent) and __family income__ (code in raw data:FAMINCG2, name in 'gss.csv':income_family) are both categorical data. Individual income indicates the income level of respondent, while family income indicates the total income of respondent's family. Both incomes are before tax and exclude any capital gains or losses. Income is inherently a numeric data, so we will transform these two variables to numeric data ranging from 1 to 7 which represent the income level. Below is a reference table shared by both family and respondent income:
```{r, echo=FALSE}
inc_name = c("Less than $25,000","$25,000 to $49,999","$50,000 to $74,999","$75,000 to $99,999","$100,000 to $ 124,999","$125,000 and more")
rank = group_by(gss_numeric, income_respondent) %>% summarise(.groups = 'drop')
rank = rank$income_respondent
tibble(`Income Level`=inc_name, `Numeric Level`=rank)
```


__Self rated health__ (code in raw data:SRH_110, name in 'gss.csv':self_rated_health) is a categorical data that indicates what the respondent think his/her health level is. We will also transform this variable to numeric data with range from 1-5. Below is the reference table:
```{r, echo=FALSE}
health_name = c("Poor","Fair","Good","Very good","Execellent")
rank = group_by(gss_numeric, health) %>% summarise(.groups = 'drop')
rank = rank$health
tibble(`Self Rated Health Level`=health_name, `Numeric Level`=rank)
```


__Average working hours__ (code in raw data:UHW_16GR, name in 'gss.csv':average_hours_worked) is a categorical data that indicates how many hours the respondent works a week on average. We will convert the variable to numeric with range from 1-5. Below is the reference table:
```{r, echo=FALSE}
hrs_name = c("0 hour","0.1 to 29.9 hours","30.0 to 40.0 hours","40.1 to 50.0 hours","50.1 hours and more")
rank = group_by(gss_numeric, work_hours) %>% summarise(.groups = 'drop')
rank = rank$work_hours
tibble(`Self Work Hour Level`=hrs_name, `Numeric Level`=rank)

```




## Model
```{r, echo=FALSE}
contrasts(gss_numeric$marriage) <- contr.treatment(6,base = 5)
model <- brm(formula = feelings_life ~ marriage + education + health + income_respondent + income_family + work_hours,
             data = gss_numeric,
             seed = 84)
summary(model)
```

We will use a Bayesian linear regression model. The reason is that Bayesian gives a more compact confidence interval and the simple linear model does (reference).

Introduce the selected model here. It is expected that you will use some mathematical notation here. If you do please ensure that all notation is explained. You may also want to discuss any special (hypothetical) cases of your model here, as well as any caveats.  

## Results

```{r, echo=FALSE}
hist(gss_numeric$feelings_life)
```

```{r, echo=FALSE}
ggplot(gss_numeric, aes(x=health, y=feelings_life)) + geom_point()

ggplot(gss_numeric, aes(x=education, group=education, y=feelings_life)) + geom_boxplot()

ggplot(gss_numeric, aes(x=health, group=health, y=feelings_life)) + geom_boxplot()

ggplot(gss_numeric, aes(x=income_respondent, group=income_respondent, y=feelings_life)) + geom_boxplot()

ggplot(gss_numeric, aes(x=income_family, group=income_family, y=feelings_life)) + geom_boxplot()

ggplot(gss_numeric, aes(x=work_hours, group=work_hours, y=feelings_life)) + geom_boxplot()

ggplot(gss_numeric, aes(x=marriage, group=marriage, y=feelings_life)) + geom_boxplot()

```

Here you will include all results. This includes descriptive statistics, graphs, figures, tables, and model results. Please ensure that everything is well formatted and in a report style. You must also provide an explanation of the results in this section. You can overflow to an Appendix if needed. 

Please ensure that everything is well labelled. So if you have multiple histograms and plots, calling them Figure 1, 2, 3, etc. and referencing them as Figure 1, Figure 2, etc. in your report will be expected. The reader should not get lost in a sea of information. Make sure to have the results be clean, well formatted and digestible.

## Discussion

Here you will discuss conclusions drawn from the results and comment on how it relates to the original goal of the study (which was specified in the Introduction).

# Weaknesses

Here we discuss weaknesses of the study, data, analysis, etc. You can also discuss areas for improvement.

# Next Steps

Here you discuss subsequent work to be done after this report. This can include next steps in terms of statistical analysis (perhaps there is a more efficient algorithm available, or perhaps there is a caveat in the data that would allow for some new technique). Future steps should also be specified in terms of the study setting (eg. including a follow-up survey on something, or a subsequent study that would complement the conclusions of your report).


## References
 Statistics Canada, year of publication, name of product, catalogue number, volume and issue numbers, reference period and page(s).


